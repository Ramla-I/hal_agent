**RM0091** **System window watchdog (WWDG)**

# **24 System window watchdog (WWDG)**

## **24.1 Introduction**


The system window watchdog (WWDG) is used to detect the occurrence of a software fault,
usually generated by external interference or by unforeseen logical conditions, which
causes the application program to abandon its normal sequence. The watchdog circuit
generates an MCU reset on expiry of a programmed time period, unless the program
refreshes the contents of the down-counter before the T6 bit becomes cleared. An MCU
reset is also generated if the 7-bit down-counter value (in the control register) is refreshed
before the down-counter has reached the window register value. This implies that the
counter must be refreshed in a limited window.


The WWDG clock is prescaled from the APB clock and has a configurable time-window that
can be programmed to detect abnormally late or early application behavior.


The WWDG is best suited for applications which require the watchdog to react within an
accurate timing window.

## **24.2 WWDG main features**


      - Programmable free-running down-counter


      - Conditional reset


–
Reset (if watchdog activated) when the down-counter value becomes lower than
0x40


–
Reset (if watchdog activated) if the down-counter is reloaded outside the window
(see _Figure 214_ )


      - Early wake-up interrupt (EWI): triggered (if enabled and the watchdog activated) when
the down-counter is equal to 0x40.

## **24.3 WWDG functional description**


If the watchdog is activated (the WDGA bit is set in the WWDG_CR register) and when the
7-bit down-counter (T[6:0] bits) is decremented from 0x40 to 0x3F (T6 becomes cleared), it
initiates a reset. If the software reloads the counter while the counter is greater than the
value stored in the window register, then a reset is generated.


The application program must write in the WWDG_CR register at regular intervals during
normal operation to prevent an MCU reset. This operation must occur only when the counter
value is lower than the window register value and higher than 0x3F. The value to be stored
in the WWDG_CR register must be between 0xFF and 0xC0.


Refer to _Figure 213_ for the WWDG block diagram.


RM0091 Rev 10 583/1017



588


**System window watchdog (WWDG)** **RM0091**


**24.3.1** **WWDG block diagram**


**Figure 213. Watchdog block diagram**























**24.3.2** **Enabling the watchdog**


The watchdog is always disabled after a reset. It is enabled by setting the WDGA bit in the
WWDG_CR register, then it cannot be disabled again except by a reset.


**24.3.3** **Controlling the down-counter**


This down-counter is free-running, counting down even if the watchdog is disabled. When
the watchdog is enabled, the T6 bit must be set to prevent generating an immediate reset.


The T[5:0] bits contain the number of increments that represent the time delay before the
watchdog produces a reset. The timing varies between a minimum and a maximum value
due to the unknown status of the prescaler when writing to the WWDG_CR register (see
_Figure 214_ ). The _WWDG configuration register (WWDG_CFR)_ contains the high limit of the
window: to prevent a reset, the down-counter must be reloaded when its value is lower than
the window register value and greater than 0x3F. _Figure 214_ describes the window
watchdog process.


_Note:_ _The T6 bit can be used to generate a software reset (the WDGA bit is set and the T6 bit is_
_cleared)._


**24.3.4** **How to program the watchdog timeout**


Use the formula in _Figure 214_ to calculate the WWDG timeout.


**Warning:** **When writing to the WWDG_CR register, always write 1 in the**
**T6 bit to avoid generating an immediate reset.**


584/1017 RM0091 Rev 10


**RM0091** **System window watchdog (WWDG)**


**Figure 214. Window watchdog timing diagram**










|Col1|Col2|
|---|---|
|||
|||
|||



The formula to calculate the timeout value is given by:

tWWDG = tPCLK × 4096 × 2 [WDGTB[1:0]] × ( T 5:0 [ ] + 1 ) ( ms )


where:


t WWDG : WWDG timeout


t PCLK : APB clock period measured in ms


4096: value corresponding to internal divider


As an example, if APB frequency is 48 MHz, WDGTB1:0] is set to 3 and T[5:0] is set to 63:

tWWDG = ( 1 ⁄ 48000 ) × 4096 × 2 [3] × ( 63 + 1 ) = 43.69ms


Refer to the datasheet for the minimum and maximum values of t WWDG .


**24.3.5** **Debug mode**


When the device enters debug mode (processor halted), the WWDG counter either
continues to work normally or stops, depending on the configuration bit in DBG module. For
more details refer to _Section 32.9.2: Debug support for timers, watchdog and I_ _[2]_ _C_ .


RM0091 Rev 10 585/1017



588


**System window watchdog (WWDG)** **RM0091**

## **24.4 WWDG interrupts**


The early wake-up interrupt (EWI) can be used if specific safety operations or data logging
must be performed before the actual reset is generated. The EWI interrupt is enabled by
setting the EWI bit in the WWDG_CFR register. When the down-counter reaches the value
0x40, an EWI interrupt is generated and the corresponding interrupt service routine (ISR)
can be used to trigger specific actions (such as communications or data logging) before
resetting the device.


In some applications the EWI interrupt can be used to manage a software system check
and/or system recovery/graceful degradation, without generating a WWDG reset. In this
case the corresponding ISR has to reload the WWDG counter to avoid the WWDG reset,
then trigger the required actions.


The EWI interrupt is cleared by writing '0' to the EWIF bit in the WWDG_SR register.


_Note:_ _When the EWI interrupt cannot be served (for example due to a system lock in a higher_
_priority task) the WWDG reset is eventually generated._

## **24.5 WWDG registers**


Refer to _Section 1.2 on page 42_ for a list of abbreviations used in register descriptions.


The peripheral registers can be accessed by halfwords (16-bit) or words (32-bit).


**24.5.1** **WWDG control register (WWDG_CR)**


Address offset: 0x000


Reset value: 0x0000 007F

|31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|
|||||||||||||||||


|15|14|13|12|11|10|9|8|7|6 5 4 3 2 1 0|Col11|Col12|Col13|Col14|Col15|Col16|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|WDGA|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|
|||||||||rs|rw|rw|rw|rw|rw|rw|rw|



Bits 31:8 Reserved, must be kept at reset value.


Bit 7 **WDGA:** Activation bit

This bit is set by software and only cleared by hardware after a reset. When WDGA = 1, the
watchdog can generate a reset.
0: Watchdog disabled
1: Watchdog enabled


Bits 6:0 **T[6:0]:** 7-bit counter (MSB to LSB)

These bits contain the value of the watchdog counter, decremented every
(4096 x 2 [WDGTB] [1:0]] ) PCLK cycles. A reset is produced when it is decremented from 0x40 to
0x3F (T6 becomes cleared).


586/1017 RM0091 Rev 10


**RM0091** **System window watchdog (WWDG)**


**24.5.2** **WWDG configuration register (WWDG_CFR)**


Address offset: 0x004


Reset value: 0x0000 007F

|31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|
|||||||||||||||||


|15|14|13|12|11|10|9|8 7|Col9|6 5 4 3 2 1 0|Col11|Col12|Col13|Col14|Col15|Col16|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|EWI|WDGTB[1:0]|WDGTB[1:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|
|||||||rs|rw|rw|rw|rw|rw|rw|rw|rw|rw|



Bits 31:10 Reserved, must be kept at reset value.


Bit 9 **EWI:** Early wake-up interrupt

When set, an interrupt occurs whenever the counter reaches the value 0x40. This interrupt is
only cleared by hardware after a reset.


Bits 8:7 **WDGTB[1:0]:** Timer base

The time base of the prescaler can be modified as follows:
00: CK counter clock (PCLK div 4096) div 1
01: CK counter clock (PCLK div 4096) div 2
10: CK counter clock (PCLK div 4096) div 4
11: CK counter clock (PCLK div 4096) div 8


Bits 6:0 **W[6:0]:** 7-bit window value

These bits contain the window value to be compared with the down-counter.


**24.5.3** **WWDG status register (WWDG_SR)**


Address offset: 0x008


Reset value: 0x0000 0000

|31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|
|||||||||||||||||


|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|EWIF|
||||||||||||||||rc_w0|



Bits 31:1 Reserved, must be kept at reset value.


Bit 0 **EWIF:** Early wake-up interrupt flag

This bit is set by hardware when the counter has reached the value 0x40. It must be cleared
by software by writing 0. Writing 1 has no effect. This bit is also set if the interrupt is not
enabled.


RM0091 Rev 10 587/1017



588


**System window watchdog (WWDG)** **RM0091**


**24.5.4** **WWDG register map**


The following table gives the WWDG register map and reset values.


**Table 78. WWDG register map and reset values**













|Offset|Register|31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|0x000|**WWDG_CR**|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|WDGA|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|T[6:0]|
|0x000|Reset value|||||||||||||||||||||||||0|1|1|1|1|1|1|1|
|0x004|**WWDG_CFR**|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|EWI|WDGTB1|WDGTB0|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|W[6:0]|
|0x004|Reset value|||||||||||||||||||||||0|0|0|1|1|1|1|1|1|1|
|0x008|**WWDG_SR**|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|Res.|EWIF|
|0x008|Reset value||||||||||||||||||||||||||||||||0|


Refer to _Section 2.2 on page 46_ for the register boundary addresses.


588/1017 RM0091 Rev 10


